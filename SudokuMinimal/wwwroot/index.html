<!DOCTYPE html>
<html>
<head>
    <title>Sudoku Validator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display:flex;
            flex-direction:column;
            align-items:center;
            padding:20px;
            background-color:#ffffff;
            color:#000000;
        }
        table { border-collapse: collapse; margin-bottom: 10px; }
        td { border: 1px solid #888; width: 42px; height: 42px; text-align:center; font-size:20px; }
        td:nth-child(3n) { border-right: 2px solid #000; }
        tr:nth-child(3n) td { border-bottom: 2px solid #000; }
        input {
            width: 40px; height: 40px; text-align:center; font-size:20px;
            border:1px solid #555; border-radius:4px;
            background-color:#f9f9f9; color:#000;
            transition: background-color 0.3s;
        }
        .invalid { background-color:#ff4d4d; color:#fff; }
        .valid   { background-color:#4caf50; color:#fff; }
        button {
            margin:5px; padding:8px 15px; font-size:16px;
            border-radius:5px; cursor:pointer;
        }
        #result { margin-top:10px; font-size:20px; }
    </style>
</head>
<body>
<h2>Sudoku Validator</h2>
<table id="grid"></table>

<div style="margin-bottom:10px;">
    <button onclick="validateSudoku()">Validate</button>
    <button onclick="solveSudoku()">Solve</button>
    <button onclick="loadTestBoard('valid')">Load Valid Board</button>
    <button onclick="loadTestBoard('invalid')">Load Invalid Board</button>
    <button onclick="clearBoard()">Clear Board</button>
    <button onclick="randomBoard()">Random Board</button>
</div>

<h3 id="result"></h3>

<script>
const table = document.getElementById('grid');
for(let i=0;i<9;i++){
    const row = table.insertRow();
    for(let j=0;j<9;j++){
        const cell = row.insertCell();
        const input = document.createElement("input");
        input.type="number"; input.min=1; input.max=9;
        cell.appendChild(input);
    }
}

// Validate Sudoku
async function validateSudoku() {
    const inputs = document.querySelectorAll("input");
    const values = [];
    inputs.forEach(i => values.push(i.value === "" ? "0" : i.value));

    const form = new FormData();
    form.append("cells", values.join(","));

    const res = await fetch("/validate", { method: "POST", body: form });
    const json = await res.json();

    // Remove previous highlights
    inputs.forEach(i => i.classList.remove("invalid", "valid"));

    if (json.valid) {
        document.getElementById("result").innerText = " VALID SUDOKU";
        // Turn all filled cells green
        inputs.forEach(i => { if(i.value !== "") i.classList.add("valid"); });
    } else {
        document.getElementById("result").innerText = " INVALID SUDOKU";
        // Turn all filled cells red
        inputs.forEach(i => { if(i.value !== "") i.classList.add("invalid"); });
    }
}

// Solve Sudoku
async function solveSudoku() {
    const inputs = document.querySelectorAll("input");
    const values=[];
    inputs.forEach(i=>values.push(i.value===""?"0":i.value));
    const form=new FormData(); form.append("cells", values.join(","));
    const res=await fetch("/solve",{method:"POST",body:form});
    const json=await res.json();
    if(json.solved){
        const board=json.board;
        for(let i=0;i<81;i++) inputs[i].value=board[i];
        document.getElementById("result").innerText="Solved!";
        inputs.forEach(i=>i.classList.remove("invalid"));
        inputs.forEach(i=>{ if(i.value!=="") i.classList.add("valid"); });
    } else {
        document.getElementById("result").innerText="Cannot solve!";
    }
}

// Clear board
function clearBoard() {
    const inputs=document.querySelectorAll("input");
    inputs.forEach(i=>{ i.value=""; i.classList.remove("invalid","valid"); });
    document.getElementById("result").innerText="";
}

// Random board generator
function randomBoard() {
    clearBoard();
    const inputs=document.querySelectorAll("input");
    for(let i=0;i<20;i++){
        let idx=Math.floor(Math.random()*81);
        inputs[idx].value=Math.floor(Math.random()*9)+1;
    }
}

// Load test boards
function loadTestBoard(type) {
    let board;
    if(type==='valid'){
        board=[5,3,4,6,7,8,9,1,2,6,7,2,1,9,5,3,4,8,1,9,8,3,4,2,5,6,7,8,5,9,7,6,1,4,2,3,4,2,6,8,5,3,7,9,1,7,1,3,9,2,4,8,5,6,9,6,1,5,3,7,2,8,4,2,8,7,4,1,9,6,3,5,3,4,5,2,8,6,1,7,9];
    } else {
        board=[5,3,4,6,7,8,9,1,2,6,7,2,1,9,5,3,4,8,1,9,8,3,4,2,5,6,7,8,5,9,7,6,1,4,2,3,4,2,6,8,5,3,7,9,1,7,1,3,9,2,4,8,5,6,9,6,1,5,3,7,2,8,4,2,8,7,4,1,9,6,3,5,3,4,5,2,8,6,5,7,9]; // duplicate
    }
    const inputs=document.querySelectorAll("input");
    for(let i=0;i<81;i++) inputs[i].value=board[i];
    document.getElementById("result").innerText="";
    inputs.forEach(i=>i.classList.remove("invalid","valid"));
}
</script>
</body>
</html>
